# AT网关客户端 - TCP直连版

一款专为4G/5G模块设计的现代化移动客户端，**直接通过TCP连接到AT命令端口**，无需中间服务器。

## ✨ 功能特性

### 📊 实时监控仪表盘
- 🔌 TCP连接状态显示
- 📶 实时信号强度监控（RSRP/RSRQ/SINR）
- 📈 RSRP趋势图表
- ⚡ 网络上下行速率显示
- 🎨 信号质量可视化（优秀/良好/一般/较差）

### 💬 短信管理
- 📱 收件箱列表显示
- ✉️ 发送短信功能
- 🔔 新短信实时推送
- 🗑️ 删除短信
- 📄 长短信自动合并显示

### 🖥️ AT控制台
- 🎯 直接发送AT命令
- 📝 实时查看响应结果
- ⚡ 常用命令快捷按钮
- 📚 命令历史记录
- 🎨 终端风格界面

### ⚙️ 设置中心
- 🔗 自定义TCP主机和端口
- 🔄 自动连接配置
- 🔔 通知开关
- 🎨 主题切换（浅色/深色/跟随系统）
- ℹ️ 版本信息

## 🎨 UI设计

- **Material Design 3** - 现代化界面设计
- **深色主题** - 默认深色模式，护眼舒适
- **渐变卡片** - 科技感十足的UI元素
- **流畅动画** - 丝滑的页面切换效果
- **响应式布局** - 适配各种屏幕尺寸

**配色方案：**
- 主色：靛蓝 `#6366F1`
- 辅色：紫色 `#8B5CF6`
- 点缀：青色 `#06B6D4`
- 背景：深蓝渐变 `#0F172A → #1E293B`

## 📋 前置要求

- Flutter SDK >= 3.0.0
- Dart SDK >= 3.0.0
- 4G/5G模块（AT命令接口开放TCP端口）

## 🚀 快速开始

### 1. 克隆项目

```bash
cd flutter_app
```

### 2. 安装依赖

```bash
flutter pub get
```

### 3. 运行项目

```bash
# 连接设备或启动模拟器
flutter devices

# 运行应用
flutter run
```

### 4. 配置TCP连接

首次运行时，在"设置"页面配置：

- **主机地址**: `192.168.8.1`
- **端口**: `20249`

点击"保存配置"，应用会自动连接到AT设备。

## ⚙️ 连接说明

### TCP直连架构

```
Flutter应用 ──TCP──► 4G/5G模块
(192.168.8.1:20249)     (AT命令接口)
```

**优势：**
- ✅ **零延迟** - 无中间服务器，响应更快
- ✅ **简单部署** - 不需要运行Python服务器
- ✅ **直接控制** - 完全掌控AT命令交互
- ✅ **离线使用** - 只需连接到模块网络

### 支持的AT命令

应用会自动初始化以下配置：

```bash
AT+CMGF=0           # 设置PDU模式
AT+CNMI=2,1,0,2,0   # 新短信通知
AT+CLIP=1           # 来电号码显示
```

## 📱 使用说明

### 仪表盘

- 实时查看TCP连接状态
- 监控信号强度变化
- 查看网络上下行速率
- RSRP趋势图分析

### 短信管理

1. **查看短信**：在短信页面浏览所有短信
2. **发送短信**：点击右下角浮动按钮
3. **删除短信**：点击短信卡片右上角菜单

### AT控制台

1. **发送命令**：在输入框输入AT命令后回车
2. **快捷命令**：点击顶部快捷按钮快速执行常用命令
3. **查看日志**：实时查看命令和响应

常用命令：
- `AT+CSQ` - 查询信号强度
- `AT+COPS?` - 查询运营商
- `AT^MONSC` - 查询小区信息
- `AT+CPIN?` - 查询SIM卡状态
- `AT+CREG?` - 查询网络注册状态
- `AT+CMGL=4` - 列出所有短信

### 设置

1. **TCP配置**：设置主机地址和端口
2. **自动连接**：启动时自动连接
3. **通知设置**：启用/禁用通知
4. **主题模式**：选择浅色/深色/跟随系统

## 📦 项目结构

```
lib/
├── main.dart                 # 应用入口
├── app/
│   ├── core/
│   │   └── theme/           # 主题配置
│   ├── data/
│   │   └── models/          # 数据模型
│   ├── routes/              # 路由配置
│   ├── services/            # 服务层
│   │   ├── tcp_service.dart      # TCP连接服务
│   │   └── storage_service.dart  # 本地存储
│   └── modules/             # 功能模块
│       ├── home/            # 主页
│       ├── dashboard/       # 仪表盘
│       ├── sms/             # 短信管理
│       ├── console/         # AT控制台
│       └── settings/        # 设置
```

## 🔧 主要依赖

| 依赖 | 版本 | 用途 |
|------|------|------|
| get | ^4.6.6 | 状态管理和路由 |
| flutter_screenutil | ^5.9.0 | 屏幕适配 |
| shared_preferences | ^2.2.2 | 本地存储 |
| fl_chart | ^0.66.0 | 图表绘制 |
| flutter_local_notifications | ^16.3.0 | 本地通知 |

## 🌐 TCP通信协议

### AT命令格式

**发送：**
```
AT+CSQ\r\n
```

**接收（示例）：**
```
+CSQ: 25,99

OK
```

### 主动上报消息

应用会自动处理以下主动上报：

**新短信：**
```
+CMTI: "ME",5
```

**来电：**
```
RING
+CLIP: "13800138000",128
```

**通话结束：**
```
^CEND:1,0,5,0
NO CARRIER
```

**信号数据：**
```
^HCSQ: "LTE",50,20,120,255
```

## 🐛 故障排除

### 无法连接到AT设备

1. 检查主机地址和端口是否正确
2. 确认手机已连接到模块WiFi
3. 测试网络连通性：`ping 192.168.8.1`
4. 检查AT端口是否开放
5. 确认模块固件支持TCP AT接口

### 收不到短信通知

1. 检查TCP连接状态
2. 手动发送 `AT+CNMI?` 查看配置
3. 重启应用重新初始化
4. 检查SIM卡状态：`AT+CPIN?`

### 信号数据不更新

1. 检查TCP连接状态
2. 发送 `AT+CSQ` 手动查询
3. 重新连接

### 命令发送失败

1. 确保命令格式正确
2. 检查TCP连接是否稳定
3. 避免连续快速发送命令
4. 查看控制台错误信息

## 🔐 网络安全

**注意事项：**

1. **内网使用** - 默认配置仅适用于内网
2. **无加密** - TCP连接未加密，不要传输敏感信息
3. **访问控制** - 建议限制模块网络访问

**生产环境建议：**
- 使用VPN加密通信
- 配置防火墙规则
- 定期更新模块固件

## 📈 性能说明

### 连接性能
- 连接建立时间：< 2秒
- 命令响应时间：< 100ms
- 自动重连间隔：5秒

### 资源占用
- 内存占用：约50-80MB
- 网络流量：极低（仅AT命令文本）
- 电池消耗：低

## 🆚 与WebSocket版本对比

| 特性 | TCP直连版 | WebSocket版本 |
|------|----------|---------------|
| 部署复杂度 | 低（无需服务器） | 高（需要Python服务器） |
| 响应延迟 | 低 | 中等 |
| 功能完整性 | 基础功能 | 完整（含企业微信推送） |
| 远程访问 | 需在同一网络 | 支持远程访问 |
| PDU解析 | 简化处理 | 完整解析 |
| 适用场景 | 本地调试、现场运维 | 远程监控、多客户端 |

## 🚀 构建发布版本

### Android APK

```bash
flutter build apk --release
# 输出: build/app/outputs/flutter-apk/app-release.apk
```

### Android App Bundle

```bash
flutter build appbundle --release
# 输出: build/app/outputs/bundle/release/app-release.aab
```

### iOS

```bash
flutter build ios --release
# 需要在Xcode中进一步配置和打包
```

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📧 联系方式

如有问题，请联系开发团队。

---

**开发团队：AT Gateway Team**

**版本：v1.0.0 (TCP Direct Connect)**

**更新日期：2025-10-10**

## 🔖 更新日志

### v1.0.0 (2025-10-10)
- ✅ 初始版本发布
- ✅ TCP直连功能
- ✅ AT命令控制台
- ✅ 短信收发管理
- ✅ 信号监控
- ✅ Material Design 3 UI
